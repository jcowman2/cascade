(this["webpackJsonpld47-cascade"]=this["webpackJsonpld47-cascade"]||[]).push([[0],{34:function(e,t,n){e.exports=n(48)},39:function(e,t,n){},40:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),i=n(28),l=n.n(i),c=(n(39),n(2)),s=n(52),u=n(23),d=(n(40),n(9)),f=n.n(d),m=n(16),p=n.n(m),h=n(4),v=n(5),g=n(11),b=n.n(g),y=n(29),k=n.n(y),E=n(33),C="piece",S=E.a.colors,O=Object(h.a)({},S,{highlight:"gold"}),j=function(e){var t=Math.floor(e/12);return{x:e-12*t,y:t}},x=function(e,t){var n=j(t),a=Math.min.apply(Math,Object(v.a)(e.slots)),r=j(a),o=n.x-r.x,i=n.y-r.y,l=e.slots.map((function(e){var t=e+12*i,n=Math.floor(t/12);return(t+o)%12+12*n}));return Object(h.a)({},e,{slots:l})},w=n(30),M=n.n(w)()(0,48).map((function(e){return{slot:e}})),P={board:M,pieces:[{id:0,slots:[17,18],kind:O.primary},{id:1,slots:[29,30],kind:O.text}],key:[{slot:5,kind:O.primary},{slot:6,kind:O.primary},{slot:7,kind:O.text}]},D={board:M,pieces:[{id:0,slots:[6,7,8,17,18,19,28,29,30],kind:O.primary},{id:1,slots:[9,10,11,20,21,22,29,30,31],kind:O.text}],key:[{slot:1,kind:O.primary},{slot:2,kind:O.text},{slot:3,kind:O.primary},{slot:4,kind:O.text},{slot:5,kind:O.primary},{slot:6,kind:O.text}]},W=[P,{board:M,pieces:[{id:0,slots:[17,18,19,31],kind:O.primary},{id:1,slots:[1,13,25,14,26],kind:O.primary},{id:2,slots:[30,42,43],kind:O.text}],key:[{slot:1,kind:O.primary},{slot:2,kind:O.primary},{slot:3,kind:O.text},{slot:4,kind:O.text},{slot:5,kind:O.primary},{slot:6,kind:O.primary}]},D],R=o.a.createContext({boardCells:[],pieces:[],setPieces:function(){},setWindowPos:function(){},setDraggingPiece:function(){},setHoverCell:function(){},availableSlots:[],key:[],cascadeView:[],cascadeMatchesKey:!1,loopSpeed:0,gameEnded:!1}),B=function(e){var t=o.a.useState([]),n=Object(c.a)(t,2),a=n[0],r=n[1],i=o.a.useState([]),l=Object(c.a)(i,2),s=l[0],u=l[1],d=o.a.useState([]),m=Object(c.a)(d,2),h=m[0],g=m[1],y=o.a.useState(!1),E=Object(c.a)(y,2),C=E[0],S=E[1],O=function(e,t,n,a){var r=o.a.useState(0),i=Object(c.a)(r,2),l=i[0],s=i[1],u=o.a.useState(0),d=Object(c.a)(u,2),f=d[0],m=d[1],p=o.a.useMemo((function(){var e=l;e>=W.length&&(console.log("num is too high",e),e=W.length-1);var t=W[e],n=t.board,a=t.pieces,r=t.key;return{board:Object(v.a)(n),pieces:Object(v.a)(a),key:Object(v.a)(r)}}),[l]);o.a.useEffect((function(){e(p.board),t(p.pieces),n(p.key),m(1)}),[p,e,t,n]);return{level:p,goToNextLevel:function(){l===W.length-1?a():s((function(e){return e+1}))},loopSpeed:f,setLoopSpeed:m}}(r,u,g,(function(){return S(!0)})),j=O.goToNextLevel,x=O.loopSpeed,w=O.setLoopSpeed,M=o.a.useState(),P=Object(c.a)(M,2),D=P[0],B=P[1],I=o.a.useState(),G=Object(c.a)(I,2),L=G[0],T=G[1],H=o.a.useState(),K=Object(c.a)(H,2),z=K[0],V=K[1],F=o.a.useMemo((function(){var e=null===L||void 0===L?void 0:L.id,t=f()(s.map((function(t){return t.id===e?[]:t.slots}))),n=a.map((function(e){return e.slot}));return p()(n,t)}),[L,s,a]),J=o.a.useMemo((function(){return function(e,t){for(var n=t?e.filter((function(e){return e.id!==t.id})):Object(v.a)(e),a=f()(n.map((function(e){return e.slots.map((function(t){return{slot:t,kind:e.kind}}))}))),r=b()(a,(function(e){return Math.floor(e.slot/12)})),o=[],i=function(e){var t=function(t){var n=r[t];if(!n)return"continue";var a=n.find((function(n){return n.slot===e+12*t}));return a?(o.push({slot:e,kind:a.kind}),"break"):void 0};e:for(var n=3;n>=0;n--){switch(t(n)){case"continue":continue;case"break":break e}}},l=0;l<12;l++)i(l);return o}(s,L)}),[s,L]),N=o.a.useMemo((function(){return function(e,t){return!(!e.length||!t.length)&&k()(e,t)}(J,h)}),[J,h]);return function(e,t,n){var a=o.a.useState(!0),r=Object(c.a)(a,2),i=r[0],l=r[1],s=o.a.useCallback((function(){t(0),setTimeout(n,1e3)}),[t,n]);o.a.useEffect((function(){e&&l(!1)}),[e]),o.a.useEffect((function(){i||(s(),l(!0))}),[i,s])}(N,w,j),o.a.createElement(R.Provider,{value:{boardCells:a,pieces:s,setPieces:u,windowPos:D,setWindowPos:B,draggingPiece:L,setDraggingPiece:T,hoverCell:z,setHoverCell:V,availableSlots:F,key:h,cascadeView:J,cascadeMatchesKey:N,loopSpeed:x,gameEnded:C}},e.children)},I=n(53),G=function(){var e=o.a.useContext(R),t=e.draggingPiece,n=e.hoverCell,a=e.availableSlots,r=!1,i=[];t&&void 0!==n&&(i=x(t,n).slots,p()(i,a).length||(r=!0));return{canDrop:r,potentialSlots:i}},L=function(){var e=G().canDrop,t=Object(I.a)({accept:C,canDrop:function(){return e}});return{dropRef:Object(c.a)(t,2)[1]}},T=function(){var e=o.a.useContext(R),t=e.boardCells,n=e.setWindowPos,a=e.hoverCell,r=e.loopSpeed,i=e.gameEnded,l=G(),c=l.canDrop,s=l.potentialSlots;return{boardCells:t,setWindowPos:n,hoverCell:a,highlightedCells:c?s:[],loopSpeed:r,gameEnded:i}},H=function(e){var t=Math.random().toString(36);return"".concat(e,"_").concat(t.substr(2,8))},K=function(e){if(!e.length)return[];var t=e.shift(),n=[t],a=new Set;for(a.add(t);n.length;){var r=n.pop(),o=[r-12,r+12];r%12>0&&o.push(r-1),(r+1)%12>0&&o.push(r+1);for(var i=function(){var t=c[l],r=e.findIndex((function(e){return e===t}));r>-1&&(e.splice(r,1),n.push(t),a.add(t))},l=0,c=o;l<c.length;l++)i()}return Array.from(a)},z=function(e,t){var n=t?e.filter((function(e){return e.id!==t.id})):Object(v.a)(e),a=[],r=b()(n,"kind"),o=function(e){(function(e){for(var t=[];e.length>0;){var n=K(e);t.push(n)}return t})(f()(r[e].map((function(e){return e.slots})))).map((function(t){return{id:H("piece"),slots:t,kind:e}})).forEach((function(e){return a.push(e)}))};for(var i in r)o(i);return t&&a.push(t),a},V=function(e,t){var n=Math.floor(e/12);return(e-12*n+t)%12+12*n},F=function(){var e=o.a.useContext(R),t=e.pieces,n=e.setPieces,a=e.setDraggingPiece,r=e.windowPos,i=e.setHoverCell,l=e.hoverCell,c=e.draggingPiece,s=e.cascadeMatchesKey,u=o.a.useCallback((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;n((function(t){var n=t.map((function(t){var n=t.slots.map((function(t){return V(t,e)}));return Object(h.a)({},t,{slots:n})}));return z(n,c)}))}),[c,n]),d=o.a.useCallback((function(e,t){a(e),r&&i(function(e,t){var n=t.x-e.x,a=t.y-e.y;return 12*Math.floor(a/70)+Math.floor(n/70)}(r,t))}),[a,i,r]),f=function(){a(void 0),i(void 0)};return{pieces:t,shiftRight:u,setDragPieceOffset:d,handlePieceDropped:function(e){console.log("dropped at",l),void 0!==l?(n((function(t){var n=t.map((function(t){return t.id===e.id?x(e,l):t}));return z(n,void 0)})),f()):console.error("handlePieceDropped",e,l)},handlePieceMissed:function(e){console.log("missed at",l),f()},canDrag:!s}},J=function(e){var t=e.cells,n=e.renderCell;return o.a.createElement("div",{style:{position:"absolute"}},t.map((function(e){var t=e.slot,a=Math.floor(t/12),r=t-12*a;return o.a.createElement("div",{key:t,style:{position:"absolute",top:70*a,left:70*r,width:70,height:70}},n(e))})))},N=function(e){var t=e.slot,n=e.style,a=void 0===n?{}:n,r=e.showLabel,i=void 0!==r&&r;return o.a.createElement("div",{style:Object(h.a)({width:70,height:70,display:"flex",justifyContent:"center",alignItems:"center"},a)},i&&o.a.createElement("span",null,t))},A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{isHidden:!1},n=o.a.useContext(R),a=n.cascadeMatchesKey,r=t.isHidden,i=o.a.useCallback((function(t){var n=t.slot,i=a?"gold":e(n);return o.a.createElement(N,{slot:n,style:r?{display:"none"}:{backgroundColor:i}})}),[e,r,a]);return i},U=function(e){var t=e.style,n=void 0===t?{}:t,a=o.a.useContext(R).cascadeView,r=o.a.useCallback((function(e){return a.find((function(t){return t.slot===e})).kind}),[a]),i=A(r);return o.a.createElement("div",{style:Object(h.a)({width:840,height:70,borderWidth:1,borderStyle:"solid",borderColor:"text"},n)},o.a.createElement(J,{cells:a,renderCell:i}))},$=function(e){return o.a.createElement("div",{style:{margin:"auto",display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",flexDirection:"column"}},e.children)},_=function(e){var t=e.style,n=o.a.useContext(R).key,a=o.a.useCallback((function(e){return n.find((function(t){return t.slot===e})).kind}),[n]),r=A(a);return o.a.createElement("div",{style:Object(h.a)({width:840,height:70,borderWidth:1,borderStyle:"solid",borderColor:"text"},t)},o.a.createElement(J,{cells:n,renderCell:r}))},q=n(32),Q=function(e){var t=e.speed,n=e.playing,a=e.onShift,r=o.a.useState(!1),i=Object(c.a)(r,2),l=i[0],s=i[1],u=o.a.useState(0),d=Object(c.a)(u,2),f=d[0],m=d[1];return o.a.createElement(q.Timeline,{playing:n,endBehavior:"loop",defaultState:{flag:0},track:[{duration:t?2e3/t:2e3,state:{flag:{to:2}}}],value:f,onTick:function(e){var t=e.value;return m(t)},onUpdate:function(e){var t=e.state,n=!!Math.floor(t.flag);n!==l&&a(),s(n)}})},X=n(51),Y=n(54),Z=n(27),ee=function(e){var t=e.slots,n=e.kind,a=e.id,r=F(),i=r.handlePieceDropped,l=r.handlePieceMissed,s=r.canDrag,u=L().dropRef,d=Object(Y.a)({item:{type:C,slots:t,kind:n,id:a},end:function(e,t){e&&(t.didDrop()?i(e):l(e))},collect:function(e){return{isDragging:!!e.isDragging()}},canDrag:function(){return s}}),f=Object(c.a)(d,3),m=f[0].isDragging,p=f[1],h=f[2];o.a.useEffect((function(){h(Object(Z.a)(),{captureDraggingState:!0})}),[h]);var v=o.a.useMemo((function(){return t.map((function(e){return{slot:e}}))}),[t]),g=o.a.useCallback((function(){return n}),[n]),b=A(g,{isHidden:m});return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{ref:function(e){p(e),u(e)},style:{cursor:s?"move":void 0,position:"absolute"}},o.a.createElement(J,{cells:v,renderCell:b})))},te=function(e){var t=e.piece,n=e.offset,a=t.slots,r=o.a.useMemo((function(){return a.map((function(e){return{slot:e}}))}),[a]),i=o.a.useCallback((function(){return t.kind}),[t]),l=A(i),c=o.a.useMemo((function(){var e=t.slots.map((function(e){return e%12}));return 70*Math.min.apply(Math,Object(v.a)(e))}),[t]),s=o.a.useMemo((function(){var e=t.slots.map((function(e){return e%4}));return 70*Math.min.apply(Math,Object(v.a)(e))}),[t]);return o.a.createElement("div",{style:{position:"fixed",top:n.y-s+24,left:n.x-c+24}},o.a.createElement(J,{cells:r,renderCell:l}))},ne=function(e){var t=e.pieces,n=F().setDragPieceOffset,a=Object(X.a)((function(e){return{item:e.getItem(),absoluteOffset:e.getClientOffset()}})),r=a.item,i=a.absoluteOffset;return o.a.useEffect((function(){r&&i&&n(r,i)}),[r,i,n]),o.a.createElement(o.a.Fragment,null,r&&i&&o.a.createElement(te,{piece:r,offset:i}),t.map((function(e){return o.a.createElement(ee,{key:e.id,id:e.id,slots:e.slots,kind:e.kind})})))},ae=function(e){var t=e.cells,n=T().highlightedCells,a=L().dropRef;return o.a.createElement("div",{ref:a},o.a.createElement(J,{cells:t,renderCell:function(e){var t=e.slot;return o.a.createElement(N,{key:t,slot:t,style:{backgroundColor:n.includes(t)?O.highlight:"inherit",opacity:.5}})}}))},re=function(){var e=o.a.useState(),t=Object(c.a)(e,2),n=t[0],a=t[1],r=o.a.createRef();o.a.useEffect((function(){r.current&&setInterval((function(){if(r.current){var e=r.current.getBoundingClientRect();a(e)}}),1e3)}),[r]);var i=null===n||void 0===n?void 0:n.top,l=null===n||void 0===n?void 0:n.left;return{rect:n,divRef:r,top:i,left:l}},oe=function(e){var t=e.boardCells,n=e.pieces,a=T().setWindowPos,r=re(),i=r.top,l=r.left,c=r.divRef;o.a.useEffect((function(){void 0!==i&&void 0!==l&&a({x:l,y:i})}),[i,l,a]);var s=o.a.useCallback((function(e){var t=e.slot;return o.a.createElement(N,{slot:t,showLabel:!0,style:{borderWidth:1,borderColor:"text",borderStyle:"dashed",opacity:.5}})}),[]);return o.a.createElement("div",{style:{width:840,height:280,borderWidth:1,borderStyle:"solid",borderColor:"text"},ref:c},o.a.createElement(J,{cells:t,renderCell:s}),o.a.createElement(ae,{cells:t}),o.a.createElement(ne,{pieces:n}))},ie=function(e){var t=e.onGameEnd,n=T(),a=n.boardCells,r=n.loopSpeed,i=n.gameEnded,l=F(),c=l.pieces,s=l.shiftRight,u=!!r;return o.a.useEffect((function(){i&&t()}),[t,i]),o.a.createElement($,null,o.a.createElement(Q,{speed:r,playing:u,onShift:s}),o.a.createElement(_,{style:{marginBottom:36}}),o.a.createElement(oe,{boardCells:a,pieces:c}),o.a.createElement(U,{style:{marginTop:36}}))},le=function(e){return o.a.createElement($,null,o.a.createElement("h1",{style:{fontSize:"4em",marginBottom:0}},"Thank you!"),o.a.createElement("p",null,"If you'd like to see more levels, please leave feedback!"))},ce=function(e){return o.a.createElement($,null,o.a.createElement("h1",{style:{fontSize:"6em",marginBottom:0}},"Cascade"),o.a.createElement("p",null,"Created in one weekend for Ludum Dare 47"),o.a.createElement("div",{style:{marginBottom:24}},o.a.createElement("h2",null,"Instructions:"),o.a.createElement("ul",null,o.a.createElement("li",null,"Drag and drop pieces on the board with the mouse"),o.a.createElement("li",null,"Colors cascade down vertically, collecting at the bottom of the board"),o.a.createElement("li",null,"Make the bottom window match the key at the top of the board"))),o.a.createElement("button",{onClick:e.onStart,style:{fontSize:"2em",backgroundColor:O.muted,color:O.text,padding:8,borderRadius:8}},"Start Game"))};!function(e){e[e.Welcome=0]="Welcome",e[e.Game=1]="Game",e[e.End=2]="End"}(a||(a={}));var se=function(){var e=o.a.useState(a.Welcome),t=Object(c.a)(e,2),n=t[0],r=t[1],i=null;switch(n){case a.Welcome:i=o.a.createElement(ce,{onStart:function(){return r(a.Game)}});break;case a.End:i=o.a.createElement(le,null);break;case a.Game:default:i=o.a.createElement(ie,{onGameEnd:function(){return r(a.End)}})}return o.a.createElement(s.a,{backend:u.a},o.a.createElement(B,null,o.a.createElement("div",null,i)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(se,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[34,1,2]]]);
//# sourceMappingURL=main.09884098.chunk.js.map